-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.admin_cookie_pool (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  platform text NOT NULL,
  cookie text NOT NULL,
  label text,
  user_id text,
  status USER-DEFINED NOT NULL DEFAULT 'healthy'::cookie_status,
  enabled boolean NOT NULL DEFAULT true,
  use_count integer NOT NULL DEFAULT 0,
  success_count integer NOT NULL DEFAULT 0,
  error_count integer NOT NULL DEFAULT 0,
  last_used_at timestamp with time zone,
  last_error text,
  cooldown_until timestamp with time zone,
  max_uses_per_hour integer NOT NULL DEFAULT 60,
  note text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  tier character varying NOT NULL DEFAULT 'public'::character varying CHECK (tier::text = ANY (ARRAY['public'::character varying, 'private'::character varying]::text[])),
  CONSTRAINT admin_cookie_pool_pkey PRIMARY KEY (id)
);
CREATE TABLE public.ai_api_keys (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  provider USER-DEFINED NOT NULL,
  key text NOT NULL,
  label text NOT NULL,
  enabled boolean NOT NULL DEFAULT true,
  use_count integer NOT NULL DEFAULT 0,
  error_count integer NOT NULL DEFAULT 0,
  last_used_at timestamp with time zone,
  last_error text,
  rate_limit_reset timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT ai_api_keys_pkey PRIMARY KEY (id)
);
CREATE TABLE public.alert_config (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  alert_error_spike boolean NOT NULL DEFAULT false,
  alert_cookie_low boolean NOT NULL DEFAULT false,
  alert_platform_down boolean NOT NULL DEFAULT false,
  alert_rate_limit boolean NOT NULL DEFAULT false,
  error_spike_threshold integer NOT NULL DEFAULT 50,
  error_spike_window integer NOT NULL DEFAULT 5,
  cookie_low_threshold integer NOT NULL DEFAULT 3,
  platform_down_threshold integer NOT NULL DEFAULT 5,
  rate_limit_threshold integer NOT NULL DEFAULT 100,
  cooldown_minutes integer NOT NULL DEFAULT 30,
  last_alert_at timestamp with time zone,
  last_alert_type character varying,
  notify_email boolean NOT NULL DEFAULT false,
  notify_discord boolean NOT NULL DEFAULT false,
  discord_webhook_url text,
  email_recipients ARRAY,
  health_check_enabled boolean NOT NULL DEFAULT true,
  health_check_interval integer NOT NULL DEFAULT 5,
  last_health_check_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT alert_config_pkey PRIMARY KEY (id)
);
CREATE TABLE public.announcements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title character varying NOT NULL,
  message text NOT NULL,
  type character varying DEFAULT 'info'::character varying CHECK (type::text = ANY (ARRAY['info'::character varying, 'warning'::character varying, 'success'::character varying, 'error'::character varying, 'promo'::character varying]::text[])),
  icon character varying,
  link_url text,
  link_text character varying,
  show_on_home boolean DEFAULT true,
  show_on_history boolean DEFAULT false,
  show_on_settings boolean DEFAULT false,
  show_on_docs boolean DEFAULT false,
  start_date timestamp with time zone DEFAULT now(),
  end_date timestamp with time zone,
  enabled boolean DEFAULT true,
  priority integer DEFAULT 0,
  views integer DEFAULT 0,
  dismisses integer DEFAULT 0,
  clicks integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT announcements_pkey PRIMARY KEY (id),
  CONSTRAINT announcements_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.api_keys (
  id character varying NOT NULL,
  user_id uuid NOT NULL,
  name character varying NOT NULL,
  key_hash character varying NOT NULL UNIQUE,
  key_preview character varying NOT NULL,
  key_type USER-DEFINED NOT NULL DEFAULT 'public'::api_key_type,
  enabled boolean NOT NULL DEFAULT true,
  rate_limit integer NOT NULL DEFAULT 60,
  total_requests bigint NOT NULL DEFAULT 0,
  success_count bigint NOT NULL DEFAULT 0,
  error_count bigint NOT NULL DEFAULT 0,
  last_used timestamp with time zone,
  expires_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT api_keys_pkey PRIMARY KEY (id),
  CONSTRAINT api_keys_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.banner_ads (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  image_url text NOT NULL,
  link_url text NOT NULL,
  alt_text character varying,
  placement character varying DEFAULT 'home'::character varying CHECK (placement::text = ANY (ARRAY['home'::character varying, 'result'::character varying, 'history'::character varying, 'all'::character varying]::text[])),
  position character varying DEFAULT 'bottom'::character varying CHECK ("position"::text = ANY (ARRAY['top'::character varying, 'middle'::character varying, 'bottom'::character varying]::text[])),
  badge_text character varying,
  badge_color character varying DEFAULT 'yellow'::character varying,
  sponsor_text character varying,
  start_date timestamp with time zone DEFAULT now(),
  end_date timestamp with time zone,
  enabled boolean DEFAULT true,
  priority integer DEFAULT 0,
  impressions integer DEFAULT 0,
  clicks integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT banner_ads_pkey PRIMARY KEY (id),
  CONSTRAINT banner_ads_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.bot_downloads (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id bigint,
  platform text NOT NULL,
  url text NOT NULL,
  title text,
  status text DEFAULT 'pending'::text,
  is_premium boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT bot_downloads_pkey PRIMARY KEY (id),
  CONSTRAINT bot_downloads_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.bot_users(id)
);
CREATE TABLE public.bot_users (
  id bigint NOT NULL,
  username text,
  first_name text,
  language_code text DEFAULT 'en'::text,
  is_banned boolean DEFAULT false,
  is_admin boolean DEFAULT false,
  api_key_id character varying,
  premium_expires_at timestamp with time zone,
  daily_downloads integer DEFAULT 0,
  last_download_reset timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  daily_reset_at timestamp with time zone,
  last_download_at timestamp with time zone,
  total_downloads integer DEFAULT 0,
  CONSTRAINT bot_users_pkey PRIMARY KEY (id),
  CONSTRAINT bot_users_api_key_id_fkey FOREIGN KEY (api_key_id) REFERENCES public.api_keys(id)
);
CREATE TABLE public.browser_profiles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  platform text NOT NULL DEFAULT 'all'::text,
  label text NOT NULL,
  note text,
  user_agent text NOT NULL,
  sec_ch_ua text,
  sec_ch_ua_platform text,
  sec_ch_ua_mobile text DEFAULT '?0'::text,
  accept_language text DEFAULT 'en-US,en;q=0.9'::text,
  browser USER-DEFINED NOT NULL DEFAULT 'chrome'::browser_type,
  device_type USER-DEFINED NOT NULL DEFAULT 'desktop'::device_type,
  os text,
  is_chromium boolean NOT NULL DEFAULT false,
  enabled boolean NOT NULL DEFAULT true,
  priority integer NOT NULL DEFAULT 5,
  use_count integer NOT NULL DEFAULT 0,
  success_count integer NOT NULL DEFAULT 0,
  error_count integer NOT NULL DEFAULT 0,
  last_used_at timestamp with time zone,
  last_error text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT browser_profiles_pkey PRIMARY KEY (id)
);
CREATE TABLE public.compact_ads (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  title character varying NOT NULL,
  description text,
  image_url text NOT NULL,
  link_url text NOT NULL,
  preview_title character varying,
  preview_description text,
  preview_image text,
  placement character varying DEFAULT 'sidebar'::character varying CHECK (placement::text = ANY (ARRAY['home-input'::character varying, 'home-bottom'::character varying, 'about'::character varying, 'all'::character varying]::text[])),
  size character varying DEFAULT 'medium'::character varying CHECK (size::text = ANY (ARRAY['small'::character varying, 'medium'::character varying, 'large'::character varying]::text[])),
  start_date timestamp with time zone DEFAULT now(),
  end_date timestamp with time zone,
  enabled boolean DEFAULT true,
  priority integer DEFAULT 0,
  impressions integer DEFAULT 0,
  clicks integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT compact_ads_pkey PRIMARY KEY (id),
  CONSTRAINT compact_ads_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.download_stats (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  date date NOT NULL,
  platform text NOT NULL,
  country character varying NOT NULL DEFAULT 'XX'::character varying,
  source character varying NOT NULL DEFAULT 'web'::character varying,
  total_requests bigint NOT NULL DEFAULT 0,
  success_count bigint NOT NULL DEFAULT 0,
  error_count bigint NOT NULL DEFAULT 0,
  unique_users integer NOT NULL DEFAULT 0,
  api_requests bigint NOT NULL DEFAULT 0,
  public_requests bigint NOT NULL DEFAULT 0,
  avg_response_time integer,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT download_stats_pkey PRIMARY KEY (id)
);
CREATE TABLE public.error_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  timestamp timestamp with time zone NOT NULL DEFAULT now(),
  platform text,
  error_type character varying,
  error_code text NOT NULL,
  error_message text NOT NULL,
  error_stack text,
  request_url text,
  user_id uuid,
  api_key_id character varying,
  ip_address inet,
  user_agent text,
  resolved boolean NOT NULL DEFAULT false,
  resolved_at timestamp with time zone,
  resolved_by uuid,
  CONSTRAINT error_logs_pkey PRIMARY KEY (id),
  CONSTRAINT error_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT error_logs_api_key_id_fkey FOREIGN KEY (api_key_id) REFERENCES public.api_keys(id),
  CONSTRAINT error_logs_resolved_by_fkey FOREIGN KEY (resolved_by) REFERENCES public.users(id)
);
CREATE TABLE public.push_notifications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title character varying NOT NULL,
  body text NOT NULL,
  icon text,
  image text,
  badge text,
  click_url text,
  target character varying DEFAULT 'all'::character varying CHECK (target::text = ANY (ARRAY['all'::character varying, 'users'::character varying, 'guests'::character varying, 'specific'::character varying]::text[])),
  target_user_ids ARRAY,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'scheduled'::character varying, 'sending'::character varying, 'sent'::character varying, 'failed'::character varying]::text[])),
  scheduled_at timestamp with time zone,
  sent_at timestamp with time zone,
  total_sent integer DEFAULT 0,
  total_delivered integer DEFAULT 0,
  total_clicked integer DEFAULT 0,
  total_failed integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT push_notifications_pkey PRIMARY KEY (id),
  CONSTRAINT push_notifications_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.push_subscriptions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  endpoint text NOT NULL UNIQUE,
  p256dh text NOT NULL,
  auth text NOT NULL,
  user_id uuid,
  user_agent text,
  device_type character varying,
  browser character varying,
  enabled boolean DEFAULT true,
  last_used timestamp with time zone DEFAULT now(),
  total_sent integer DEFAULT 0,
  total_clicked integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT push_subscriptions_pkey PRIMARY KEY (id),
  CONSTRAINT push_subscriptions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.service_config (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  platform text NOT NULL UNIQUE,
  enabled boolean NOT NULL DEFAULT true,
  rate_limit integer NOT NULL DEFAULT 60,
  require_cookie boolean NOT NULL DEFAULT false,
  require_auth boolean NOT NULL DEFAULT false,
  priority integer NOT NULL DEFAULT 5,
  last_check timestamp with time zone,
  health_status text NOT NULL DEFAULT 'unknown'::text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT service_config_pkey PRIMARY KEY (id)
);
CREATE TABLE public.special_referrals (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  role USER-DEFINED NOT NULL DEFAULT 'user'::user_role,
  max_uses integer DEFAULT 1,
  current_uses integer NOT NULL DEFAULT 0,
  is_active boolean NOT NULL DEFAULT true,
  note text,
  created_by uuid,
  expires_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT special_referrals_pkey PRIMARY KEY (id),
  CONSTRAINT special_referrals_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.system_config (
  key text NOT NULL,
  value jsonb NOT NULL,
  description text,
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_by uuid,
  CONSTRAINT system_config_pkey PRIMARY KEY (key),
  CONSTRAINT system_config_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.useragent_pool (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  platform character varying NOT NULL DEFAULT 'all'::character varying,
  user_agent text NOT NULL,
  device_type character varying NOT NULL DEFAULT 'desktop'::character varying,
  browser character varying,
  version character varying,
  os character varying,
  enabled boolean DEFAULT true,
  use_count integer DEFAULT 0,
  success_count integer DEFAULT 0,
  error_count integer DEFAULT 0,
  last_used_at timestamp with time zone,
  last_error text,
  note text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT useragent_pool_pkey PRIMARY KEY (id)
);
CREATE TABLE public.users (
  id uuid NOT NULL,
  email character varying NOT NULL,
  username character varying NOT NULL UNIQUE,
  display_name character varying,
  avatar_url text,
  role USER-DEFINED NOT NULL DEFAULT 'user'::user_role,
  status USER-DEFINED NOT NULL DEFAULT 'active'::user_status,
  referral_code character varying NOT NULL UNIQUE,
  referred_by uuid,
  total_referrals integer NOT NULL DEFAULT 0,
  last_seen timestamp with time zone NOT NULL DEFAULT now(),
  first_joined timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id),
  CONSTRAINT users_referred_by_fkey FOREIGN KEY (referred_by) REFERENCES public.users(id)
);